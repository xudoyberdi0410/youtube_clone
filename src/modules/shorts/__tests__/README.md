# Shorts Module Tests

Этот каталог содержит полный набор тестов для модуля Shorts, включая компоненты, хуки, типы и интеграционные тесты.

## Структура тестов

```
__tests__/
├── README.md                    # Этот файл
├── useShorts.test.ts           # Тесты для хука useShorts
├── ShortsCard.test.tsx         # Тесты для компонента ShortsCard
├── ShortsVideoCard.test.tsx    # Тесты для компонента ShortsVideoCard
├── ShortsList.test.tsx         # Тесты для компонента ShortsList
├── ShortsFeed.test.tsx         # Тесты для компонента ShortsFeed
├── shorts-integration.test.tsx # Интеграционные тесты
├── types.test.ts              # Тесты для типов
├── performance.test.tsx       # Тесты производительности
└── test-utils.ts             # Утилиты для тестов
```

## Описание тестов

### 1. useShorts.test.ts
Тесты для хука `useShorts`, который управляет состоянием и загрузкой данных shorts.

**Покрытие:**
- Инициализация состояния загрузки
- Успешная загрузка и трансформация данных
- Обработка различных типов ошибок
- Функция обновления данных
- Трансформация данных API в формат компонентов

### 2. ShortsCard.test.tsx
Тесты для компонента `ShortsCard` - базового компонента для отображения короткого видео.

**Покрытие:**
- Рендеринг компонента
- Отображение элементов управления (лайк, комментарий, поделиться)
- Структура и стилизация
- Доступность (accessibility)

### 3. ShortsVideoCard.test.tsx
Тесты для компонента `ShortsVideoCard` - основного компонента для отображения видео в формате shorts.

**Покрытие:**
- Рендеринг с различными пропсами
- Управление воспроизведением (play/pause)
- Отображение информации о канале
- Интерактивные элементы
- Обработка состояний воспроизведения

### 4. ShortsList.test.tsx
Тесты для компонента `ShortsList` - контейнера для списка shorts.

**Покрытие:**
- Рендеринг списка
- Структура компонента
- Интеграция с ShortsCard

### 5. ShortsFeed.test.tsx
Тесты для компонента `ShortsFeed` - основного компонента ленты shorts.

**Покрытие:**
- Состояния загрузки, ошибки и пустого списка
- Интерактивность пользователя
- Управление видео
- Обработка событий
- Интеграция с хуком useShorts

### 6. shorts-integration.test.tsx
Интеграционные тесты, проверяющие взаимодействие между компонентами.

**Покрытие:**
- Полный поток от загрузки до отображения
- Обработка ошибок и восстановление
- Пользовательские взаимодействия
- Поток данных между компонентами
- Доступность на всех уровнях

### 7. types.test.ts
Тесты для типов TypeScript, проверяющие корректность интерфейсов.

**Покрытие:**
- Структура интерфейса ShortVideo
- Структура интерфейса ShortsApiResponse
- Совместимость с API
- Обработка опциональных полей

### 8. performance.test.tsx
Тесты производительности для проверки эффективности рендеринга.

**Покрытие:**
- Рендеринг большого количества элементов
- Управление памятью
- Оптимизация DOM
- Быстрые изменения состояния

### 9. test-utils.ts
Утилиты и хелперы для тестов.

**Содержит:**
- Фабрики мок-данных
- Константы для тестов
- Хелперы для валидации
- Симуляторы событий
- Настройка моков

## Запуск тестов

### Запуск всех тестов модуля
```bash
npm test src/modules/shorts/__tests__/
```

### Запуск конкретного теста
```bash
npm test src/modules/shorts/__tests__/useShorts.test.ts
```

### Запуск тестов с покрытием
```bash
npm test -- --coverage src/modules/shorts/__tests__/
```

### Запуск тестов в режиме watch
```bash
npm test -- --watch src/modules/shorts/__tests__/
```

## Требования к тестам

### Покрытие кода
- Минимальное покрытие: 90%
- Все публичные API должны быть протестированы
- Все условные ветки должны быть покрыты

### Качество тестов
- Тесты должны быть независимыми
- Каждый тест должен проверять одну конкретную функциональность
- Использовать описательные названия тестов
- Включать как позитивные, так и негативные сценарии

### Моки и стабы
- Использовать моки для внешних зависимостей
- Изолировать тестируемый код от внешних систем
- Использовать фабрики для создания тестовых данных

### Производительность
- Тесты должны выполняться быстро
- Избегать избыточных операций
- Использовать эффективные селекторы

## Лучшие практики

### Организация тестов
```typescript
describe('ComponentName', () => {
  beforeEach(() => {
    // Настройка перед каждым тестом
  });

  afterEach(() => {
    // Очистка после каждого теста
  });

  describe('when condition', () => {
    it('should do something', () => {
      // Тест
    });
  });
});
```

### Использование мок-данных
```typescript
import { createMockShort } from './test-utils';

const mockShort = createMockShort({
  title: 'Custom Title',
  views_count: 5000
});
```

### Тестирование асинхронного кода
```typescript
it('should handle async operation', async () => {
  const result = await asyncFunction();
  expect(result).toBe(expectedValue);
});
```

### Тестирование событий
```typescript
it('should handle user interaction', () => {
  const handleClick = jest.fn();
  render(<Component onClick={handleClick} />);
  
  fireEvent.click(screen.getByRole('button'));
  expect(handleClick).toHaveBeenCalled();
});
```

## Отладка тестов

### Проблемы с моками
- Убедитесь, что моки настроены правильно
- Проверьте порядок импортов
- Используйте `jest.clearAllMocks()` в `beforeEach`

### Проблемы с асинхронностью
- Используйте `waitFor` для ожидания изменений
- Добавьте достаточные таймауты
- Проверьте порядок выполнения операций

### Проблемы с DOM
- Используйте `screen.debug()` для отладки
- Проверьте селекторы
- Убедитесь, что элементы рендерятся

## Обновление тестов

При изменении компонентов или хуков:

1. Обновите соответствующие тесты
2. Добавьте новые тесты для новой функциональности
3. Убедитесь, что покрытие остается высоким
4. Запустите все тесты и убедитесь, что они проходят

## Интеграция с CI/CD

Тесты автоматически запускаются в CI/CD pipeline:

- При создании pull request
- При слиянии в основную ветку
- При деплое

Убедитесь, что все тесты проходят перед слиянием изменений. 