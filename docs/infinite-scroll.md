# Бесконечная прокрутка на главной странице

## Обзор

Реализована бесконечная прокрутка для главной страницы приложения, которая автоматически загружает дополнительные видео при прокрутке вниз.

## Архитектура

### Основные компоненты

1. **`useInfiniteVideos`** - Хук для управления состоянием бесконечной прокрутки
2. **`useInfiniteScroll`** - Хук для отслеживания прокрутки с Intersection Observer
3. **`HomeVideos`** - Основной компонент главной страницы
4. **`LoadingMore`** - Компонент для отображения скелетонов при загрузке
5. **`LoadMoreIndicator`** - Индикатор состояния загрузки

### API изменения

- Обновлен метод `get` для поддержки `AbortSignal`
- Реализована клиентская пагинация (API возвращает все видео, пагинация происходит на фронтенде)

## Функциональность

### Автоматическая загрузка

- При первом заходе на страницу загружается первая порция видео (12 штук)
- При прокрутке до конца списка автоматически загружается следующая порция
- Процесс продолжается до тех пор, пока есть видео для загрузки
- Используется клиентская пагинация (все видео загружаются сразу, но отображаются порциями)

### Состояния загрузки

1. **Начальная загрузка** - Отображаются скелетоны для всех видео
2. **Загрузка дополнительных видео** - Отображаются скелетоны внизу списка
3. **Нет больше видео** - Показывается сообщение "Больше видео для загрузки нет"

### Отмена запросов

- Используется `AbortController` для отмены предыдущих запросов при смене категории
- Предотвращает гонку условий и ненужные запросы

### Кэширование

- Данные кэшируются в sessionStorage для улучшения производительности
- Кэш автоматически очищается при смене категории или фильтров

## Использование

### Основной компонент

```tsx
import { useInfiniteVideos } from "@/hooks/use-infinite-videos";
import { useInfiniteScroll } from "./use-infinite-scroll";

export default function HomeVideos() {
    const { 
        videos, 
        isLoading, 
        isLoadingMore, 
        error, 
        hasMore, 
        refetch, 
        changeCategory,
        loadMore 
    } = useInfiniteVideos();

    const loadMoreRef = useInfiniteScroll({
        onLoadMore: loadMore,
        hasMore,
        isLoading: isLoadingMore,
    });

    // ... остальной код
}
```

### Хук для бесконечной прокрутки

```tsx
const { videos, isLoading, isLoadingMore, error, hasMore, loadMore } = useInfiniteVideos({
    category: 'Musiqa',
    pageSize: 12
});
```

## Настройки

### Размер страницы

По умолчанию загружается 12 видео за раз. Можно изменить через параметр `pageSize`:

```tsx
const { videos } = useInfiniteVideos({ pageSize: 20 });
```

### Порог срабатывания

Настройки Intersection Observer можно изменить в `useInfiniteScroll`:

```tsx
const loadMoreRef = useInfiniteScroll({
    onLoadMore: loadMore,
    hasMore,
    isLoading: isLoadingMore,
    threshold: 0.1, // Срабатывает когда 10% элемента видно
    rootMargin: '100px', // Срабатывает за 100px до элемента
});
```

## Производительность

### Оптимизации

1. **Отмена запросов** - Предотвращает ненужные запросы
2. **Кэширование** - Уменьшает количество запросов к серверу
3. **Виртуализация** - Рассматривается для больших списков
4. **Lazy loading** - Изображения загружаются по мере необходимости

### Мониторинг

- Отслеживание количества загруженных видео
- Время загрузки каждой порции
- Ошибки загрузки

## Локализация

Добавлены переводы для всех поддерживаемых языков:

- **English**: "Loading more videos...", "No more videos to load"
- **Русский**: "Загрузка дополнительных видео...", "Больше видео для загрузки нет"
- **O'zbek**: "Qo'shimcha videolar yuklanmoqda...", "Yuklash uchun boshqa videolar yo'q"

## Тестирование

### Ручное тестирование

1. Откройте главную страницу
2. Прокрутите вниз до конца списка
3. Убедитесь, что загружаются дополнительные видео
4. Проверьте отображение скелетонов при загрузке
5. Проверьте сообщение "Больше видео для загрузки нет"

### Автоматическое тестирование

```tsx
// Тест для useInfiniteVideos
describe('useInfiniteVideos', () => {
    it('should load initial videos', () => {
        // Тест начальной загрузки
    });

    it('should load more videos on scroll', () => {
        // Тест загрузки дополнительных видео
    });

    it('should handle errors gracefully', () => {
        // Тест обработки ошибок
    });
});
```

## Будущие улучшения

1. **Виртуализация списка** - Для больших списков видео
2. **Предзагрузка** - Загрузка следующей порции заранее
3. **Адаптивный размер страницы** - В зависимости от размера экрана
4. **Офлайн поддержка** - Кэширование для работы без интернета
5. **Аналитика** - Отслеживание поведения пользователей 